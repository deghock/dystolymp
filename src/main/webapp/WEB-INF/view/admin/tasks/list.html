<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Система интернет-олимпиад СПбГУ</title>

    <link rel="stylesheet" th:href="@{/webjars/bootstrap/4.6.0/css/bootstrap.min.css}"/>
    <link rel="stylesheet" th:href="@{/css/style.css}"/>
    <style>
        p {
            text-align: center;
        }

        legend {
            display: block;
            width: auto;
            padding: 0 5px;
            margin-bottom: 0;
            font-size: inherit;
            line-height: inherit;
            border-bottom: none;
        }

        fieldset {
            border: 2px groove white;
            padding: 5px;
        }
    </style>
</head>

<div th:replace="fragments/header :: #header"></div>

<body class="bgGrey">

<div th:replace="fragments/menu-staff :: #menustaff"></div>

<p id="title">Задачи</p>

<div class="container">
    <div class="alert alert-danger text-center mx-auto" role="alert" style="width: 50%"
         th:text="${error}" th:if="${error}"><br/></div>
    <div class="alert alert-success text-center mx-auto" role="alert" style="width: 50%"
         th:text="${success}" th:if="${success}"><br/></div>

    <div class="input-group mb-3 mx-auto" style="width: 50%">
        <input type="text" id="task-title" class="form-control"
               placeholder="Фильтр задач по заголовку и префиксу..." aria-describedby="search-button">
        <button class="btn btn-secondary" type="submit" id="search-button">Поиск</button>
    </div>

    <div id="towns-table" th:replace="admin/tasks/tasks-table :: #tasks-table"></div>

    <ul class="actions text-center" style="width: 50%">
        <li style="width: 100%">
            <a th:href="@{/tasks/add}" class="abutton">Создать новую задачу</a>
        </li>
    </ul>
</div>

<div th:replace="fragments/footer :: #footer"></div>
</body>

<script type="text/javascript" th:src="@{/webjars/jquery/3.5.1/jquery.min.js/}"></script>
<script type="text/javascript" th:src="@{/webjars/bootstrap/4.6.0/js/bootstrap.min.js}"></script>
<script type="text/javascript">
    $("#task-title").on("keyup", function (event) {
        if (event.keyCode === 13) {
            event.preventDefault();
            search();
        }
    })

    function search() {
        document.getElementById("search-button").click();
    }

    $("#search-button").click(function () {
        getTasks();
    })

    function getTasks() {
        var params = encodeQueryData(getParams());
        var url = "filter?" + params;
        $.get(url).done(function (fragment) {
            $("#tasks-table").replaceWith(fragment);
        });
    }

    function encodeQueryData(data) {
        const result = [];
        for (var key in data) {
            result.push(key + '=' + data[key]);
        }
        return result.join('&');
    }

    function getParams() {
        var params = {}
        params["resultSize"] = getResultSize();
        params["containsTitle"] = getTitle();
        return params;
    }

    function getResultSize() {
        return '0';
    }

    function getTitle() {
        return $("#task-title").val();
    }
</script>

</html>